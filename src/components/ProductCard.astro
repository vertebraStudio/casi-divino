---
import Star from './Star.astro';

interface Props {
  title: string;
  image: string;
  price: string;
  rating: number;
  affiliateUrl: string;
  pros?: string[];
  contras?: string[];
}

const { title, image, price, rating, affiliateUrl, pros = [], contras = [] } = Astro.props;

const clampedRating = Math.max(0, Math.min(5, rating));
const fullStars = Math.round(clampedRating);
const stars = Array.from({ length: 5 }, (_, i) => i < fullStars);
---

<article class="flex h-full flex-col rounded-2xl border border-slate-200 bg-white/80 p-4 shadow-sm shadow-slate-900/5 transition hover:-translate-y-0.5 hover:shadow-lg hover:shadow-vino-900/10 dark:border-slate-800 dark:bg-slate-900/80">
  <div class="flex flex-col gap-4 sm:flex-row">
    <div class="sm:w-32">
      <div class="aspect-square overflow-hidden rounded-xl bg-slate-100 dark:bg-slate-900">
        <img
          src={image}
          alt={title}
          loading="lazy"
          class="h-full w-full object-cover"
        />
      </div>
    </div>

    <div class="flex flex-1 flex-col gap-2">
      <h3 class="font-serif text-base font-semibold text-slate-900 dark:text-slate-50">
        {title}
      </h3>

      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-1">
          {stars.map((filled, index) => (
            <Star
              class:list={[
                'h-4 w-4',
                filled ? 'text-amber-400 fill-amber-400' : 'text-slate-300 dark:text-slate-700',
              ]}
              aria-hidden="true"
            />
          ))}
          <span class="ml-1 text-xs text-slate-500 dark:text-slate-400">
            {clampedRating.toFixed(1)} / 5
          </span>
        </div>
        <p class="text-sm font-semibold text-vino-600 dark:text-vino-200">
          {price}
        </p>
      </div>

      {(pros.length > 0 || contras.length > 0) && (
        <div class="mt-1 grid gap-3 text-xs text-slate-600 dark:text-slate-300 sm:grid-cols-2">
          {pros.length > 0 && (
            <div>
              <p class="mb-1 font-semibold text-emerald-600 dark:text-emerald-300">
                Pros
              </p>
              <ul class="space-y-0.5">
                {pros.map((item) => (
                  <li class="flex gap-1.5">
                    <span>+</span>
                    <span>{item}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}

          {contras.length > 0 && (
            <div>
              <p class="mb-1 font-semibold text-red-600 dark:text-red-300">
                Contras
              </p>
              <ul class="space-y-0.5">
                {contras.map((item) => (
                  <li class="flex gap-1.5">
                    <span>âˆ’</span>
                    <span>{item}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}
        </div>
      )}

      <div class="mt-3">
        <a
          href={affiliateUrl}
          target="_blank"
          rel="nofollow sponsored"
          class="inline-flex w-full items-center justify-center rounded-full bg-vino-600 px-4 py-2 text-sm font-semibold text-white shadow-md shadow-vino-700/30 transition hover:bg-vino-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-vino-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900"
        >
          Ver precio en Amazon
        </a>
      </div>
    </div>
  </div>
</article>


